#!/usr/bin/env python

# Import python libs
import sys
import select
import optparse


def format_jobs(opts):
    if select.select([sys.stdin], [], [], 0) == ([], [], []):
        # There's nothing to read
        return

    items = []
    while True:
        item = sys.stdin.readline()
        if not item:
            break
        items.append(
            '\033{0}{1}\033{2}'.format(
                opts.job_color, item.split()[2], opts.text_color
            )
        )

    if not items:
        return

    if len(items) > 2:
        string = '{0}, and {1}'.format(', '.join(items[:-1]), items[-1])
    else:
        string = ', '.join(items)
    print(
        '{0}\033{1}running {2}\033[0m'.format(
            opts.pre_space and ' ' or '',
            opts.text_color,
            string
        )
    )


def main():
    parser = optparse.OptionParser()
    parser.add_option(
        '-t', '--text-color',
        default='[37m'
    )
    parser.add_option(
        '-j', '--job-color',
        default='[36m'
    )
    parser.add_option(
        '-s', '--pre-space',
        action='store_true',
        default=False
    )
    opts, args = parser.parse_args()
    if args:
        parser.error('No arguments are supported')
    format_jobs(opts)


if __name__ == '__main__':
    main()
